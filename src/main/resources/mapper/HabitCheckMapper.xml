<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.HabitCheck.mapper.HabitCheckMapper">

    <!-- HabitCheckVO에 대한 resultMap 정의 -->
    <resultMap id="HabitCheckResultMap" type="com.example.backend.HabitCheck.vo.HabitCheckVO">
        <result property="checkDate" column="check_date"/>
        <result property="myHabitId" column="my_habit_id"/>
        <result property="userId" column="user_id"/>
        <result property="habitId" column="habit_id"/>
    </resultMap>

    <!-- 달성한 습관 삽입 -->
    <insert id="insertHabitCheck" parameterType="com.example.backend.HabitCheck.vo.HabitCheckVO">
        INSERT INTO HabitCheck (check_date, my_habit_id, user_id, habit_id)
        VALUES (#{checkDate}, #{myHabitId}, #{userId}, #{habitId})
    </insert>

    <!-- 오늘 달성한 습관 목록 -->
    <select id="selectTodayHabitCheck" parameterType="long" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = CURDATE() AND user_id = #{userId};
    </select>

    <!-- 과거 달성한 습관 목록 -->
    <select id="selectPastHabitCheck" parameterType="map" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = CURDATE() AND user_id = #{userId};
    </select>

    <!-- 과거 달성한 습관 목록 (특정 날짜) -->
    <select id="selectPastHabitCheckDate" parameterType="map" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = #{checkDate} AND user_id = #{userId};
    </select>

    <!-- 과거 달성한 습관 목록 (1일 전) -->
    <select id="selectPastHabitCheckDay" parameterType="map" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = CURDATE() - INTERVAL 1 DAY AND user_id = #{userId};
    </select>

    <!-- 과거 달성한 습관 목록 (1주 전) -->
    <select id="selectPastHabitCheckWeek" parameterType="map" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = CURDATE() - INTERVAL 1 WEEK AND user_id = #{userId};
    </select>

    <!-- 과거 달성한 습관 목록 (1달 전) -->
    <select id="selectPastHabitCheckMonth" parameterType="map" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = CURDATE() - INTERVAL 1 MONTH AND user_id = #{userId};
    </select>

    <!-- 과거 달성한 습관 목록 (1년 전) -->
    <select id="selectPastHabitCheckYear" parameterType="map" resultMap="HabitCheckResultMap">
        SELECT h.habit_title, h.category_title
        FROM `HabitCheck` hc
                 JOIN `MyHabit` mh ON hc.my_habit_id = mh.my_habit_id
                 JOIN `Habit` h ON mh.habit_id = h.habit_id
        WHERE DATE(hc.check_date) = CURDATE() - INTERVAL 1 YEAR AND user_id = #{userId};
    </select>

    <!-- 특정 습관 -->
    <select id="selectHabitCheckById" parameterType="long" resultMap="HabitCheckResultMap">
        SELECT * FROM HabitCheck WHERE my_habit_id = #{myHabitId}
    </select>

    <!-- 모든 습관  -->
    <select id="selectAllHabitChecks" resultMap="HabitCheckResultMap">
        SELECT * FROM HabitCheck
    </select>
</mapper>